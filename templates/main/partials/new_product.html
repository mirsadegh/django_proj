{% load custom_filters static %}
{% load static %}


<!-- لینک به فایل CSS جداگانه -->
<link rel="stylesheet" href="{% static 'main/css/new_product_slider.css' %}">

<div class="section">
    <!-- container -->
    <div class="container">
        <!-- row -->
        <div class="row">
            <!-- section title -->
            <div class="col-md-12">
                <div class="section-title">
                    <h3 class="title">محصولات جدید</h3>
                </div>
            </div>
            <!-- /section title -->

            <!-- Products tab & slick -->
            <div class="col-md-12">
                <div class="row">
                    <div class="products-tabs">
                        <!-- tab -->
                        <div id="tab1" class="tab-pane active">
                            <!-- بررسی وجود محصولات -->
                            {% if products %}
                                <div class="products-slick" dir="rtl">
                                    {% for product in products %}
                                        <div class="product slick-slide">
                                            <div class="product-img" style="height: 200px; overflow: hidden;">
                                                {% if product.image %}
                                                    <img src="{{ product.image.url }}" 
                                                         alt="{{ product.title }}" 
                                                         loading="lazy"
                                                         onerror="this.src='{% static 'images/no-image.png' %}'">
                                                {% else %}
                                                    <img src="{% static 'images/no-image.png' %}" 
                                                         alt="{{ product.title }}">
                                                {% endif %}
                                                <div class="product-label">
                                                    {% if product.current_price < product.price %}
                                                        <span class="sale">-{{ product.discount_percentage|floatformat:"0" }}%</span>
                                                    {% endif %}
                                                    <span class="new">NEW</span>
                                                </div>
                                            </div>
                                            <div class="product-body">
                                                <p class="product-category">{{ product.category.name }}</p>
                                                <h3 class="product-name">
                                                    <a href="{% url 'product_detail' product.slug %}">{{ product.title }}</a>
                                                </h3>
                                                {% if product.current_price < product.price %}
                                                    <h4 class="product-price">
                                                        {{ product.current_price|persian_numbers }} تومان 
                                                        <del class="product-old-price">{{ product.price|persian_numbers }} تومان</del>
                                                    </h4>
                                                {% else %}
                                                    <h4 class="product-price">{{ product.price|persian_numbers }} تومان</h4>
                                                {% endif %}
                                                <div class="product-rating">
                                                    <div class="star-rating">
                                                        {{ product.average_rating|star_rating }}
                                                    </div>
                                                </div>
                                                <div class="product-btns">
                                                    {% if request.user.is_authenticated %}
                                                        <button
                                                            class="add-to-wishlist {% if product_interests|get_item:product.id %}active{% endif %}"
                                                            data-product-id="{{ product.id }}"
                                                            data-url="{% url 'interests:toggle_interest' product.id %}"
                                                            tabindex="0"
                                                        >
                                                            <i class="fa {% if product_interests|get_item:product.id %}fa-heart text-red{% else %}fa-heart-o{% endif %}"></i>
                                                            <span class="tooltipp">
                                                                {% if product_interests|get_item:product.id %}
                                                                    حذف از علاقه‌مندی
                                                                {% else %}
                                                                    افزودن به علاقه‌مندی
                                                                {% endif %}
                                                            </span>
                                                        </button>
                                                    {% endif %}
                                                    
                                                    <button class="add-to-compare">
                                                        <i class="fa fa-exchange"></i>
                                                        <span class="tooltipp">مقایسه</span>
                                                    </button>
                                                    <button class="quick-view">
                                                        <a href="{% url 'product_detail' product.slug %}">
                                                            <i class="fa fa-eye"></i>
                                                        </a>
                                                        <span class="tooltipp">نمایش</span>
                                                    </button>
                                                </div>
                                                <div class="add-to-cart">
                                                <button class="add-to-cart-btn" data-product-id="{{ product.id }}">
                                                    <i class="fa fa-shopping-cart"></i> افزودن به سبد خرید
                                                </button>
                                            </div>
                                            </div>
                                            
                                        </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <!-- نمایش پیام در صورت عدم وجود محصول -->
                                <div class="no-products text-center">
                                    <p>هنوز محصولی اضافه نشده است.</p>
                                </div>
                            {% endif %}
                        </div>
                        <!-- /tab -->
                    </div>
                </div>
            </div>
            <!-- Products tab & slick -->
        </div>
        <!-- /row -->
    </div>
    <!-- /container -->
</div>

<!-- اسکریپت اضافی برای اطمینان از عملکرد اسلایدر -->
<script src="{% static 'main/js/new_product_slider.js' %}"></script>